<!doctype html>
<html lang="sr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Unesi kod — Novo Ropstvo</title>
  <meta name="description" content="Unos koda za preuzimanje EPUB fajla.">
  <link rel="canonical" href="./kod.html">
  <script src="./js/lang-switcher.js" defer></script>
  <style>
    :root { --max:720px }
    *{box-sizing:border-box} body{margin:0;background:#0b0f12;color:#e8e8e8;font:16px/1.5 system-ui,Segoe UI,Roboto,Arial,sans-serif}
    .wrap{max-width:var(--max);margin:0 auto;padding:24px}
    h1{margin:8px 0 16px;font-size:clamp(22px,3vw,32px)}
    form{display:grid;gap:12px;background:#10161c;border:1px solid #1f2a33;padding:16px;border-radius:14px}
    input,button{padding:12px 14px;border-radius:10px;border:1px solid #2a3945;background:#0f1419;color:#e8e8e8}
    button{cursor:pointer}
    .msg{margin-top:10px;font-size:14px}
    a{color:#cde3ff}
  </style>
</head>
<body>
  <main class="wrap">
    <h1>Unos koda</h1>
    <p><a href="./placanje.html">← Nazad na Uplatu</a></p>

    <form id="f">
      <label>Kod (obavezno)
        <input name="kod" placeholder="npr. AB12-CD34" required>
      </label>
      <label>Email (opciono)
        <input type="email" name="email" placeholder="vas@email.com">
      </label>
      <button type="submit">Proveri kod</button>
      <div class="msg" id="msg"></div>
    </form>

    <p style="opacity:.8;font-size:14px">Napomena: Kod važi 48h od izdavanja. Jedno preuzimanje po kodu.</p>
  </main>

  <script>
  const ENDPOINT = "APPS_SCRIPT_URL"; // ← ovde ćemo uneti tvoj Apps Script URL kad bude spreman

  document.getElementById('f').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const msg = document.getElementById('msg'); msg.textContent = "⏳ Provera koda…";
    const fd = new FormData(e.target);
    const params = new URLSearchParams();
    params.set("kod", (fd.get("kod")||"").trim());
    if (fd.get("email")) params.set("email", fd.get("email").trim());
    try {
      // GET je jednostavan za test (kasnije možemo POST)
      const r = await fetch(`${ENDPOINT}?${params.toString()}`, { method:"GET", cache:"no-store" });
      const t = await r.text();
      // očekujemo plain-text poruke Apps Script-a:
      if (t.startsWith("OK|")) {
        const url = t.split("|")[1]; // npr. pre-signed link ka EPUB
        msg.innerHTML = `✅ Kod je važeći. <a href="${url}">Preuzmi EPUB</a>`;
      } else {
        msg.textContent = t; // npr. "❌ Kod je istekao." ili "❌ Kod ne postoji."
      }
    } catch(err) {
      msg.textContent = "❌ Greška pri proveri. Pokušajte ponovo.";
    }
  });
  </script>
</body>
</html>
