<!doctype html>
<html lang="sr">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Unos koda — Novo Ropstvo</title>
<link rel="icon" href="favicon.ico">
<style>
  body{font-family:system-ui,Segoe UI,Arial;margin:0;background:#0f0f0f;color:#eaeaea}
  .wrap{max-width:520px;margin:40px auto;padding:24px;background:#171717;border:1px solid #2a2a2a;border-radius:16px}
  h1{font-size:1.35rem;margin:0 0 12px}
  label{display:block;margin:.5rem 0 .25rem}
  input{width:100%;padding:.75rem;border-radius:10px;border:1px solid #333;background:#111;color:#eee}
  button{margin-top:12px;padding:.75rem 1rem;border:0;border-radius:10px;background:#2a7;cursor:pointer;color:#041}
  button:disabled{opacity:.6;cursor:not-allowed}
  .msg{margin-top:16px;padding:12px;border-radius:10px;background:#111;border:1px solid #333}
  a{color:#9fd}
</style>
<div class="wrap">
  <h1>Unesite kod za preuzimanje</h1>
  <label for="kod">Kod</label>
  <input id="kod" autocomplete="one-time-code" placeholder="npr. ABCD1234"/>
  <button id="go">Otključaj</button>
  <div id="out" class="msg" hidden></div>
</div>
<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxqAeTAG7kCdSq0gdMFM7iHzLwWu20gVDqyBxy80PFweoe8a5JkJcpNIP0yutQ_N82P/exec";

const input = document.getElementById('code');
const btn = document.getElementById('check');
const msg = document.getElementById('msg');
const dl  = document.getElementById('dl');

function showHtml(html){ msg.innerHTML = html; msg.style.color = ""; }
function showErr(t){ msg.textContent = "❌ " + t; msg.style.color="#ff7b72"; }
function showWait(){ msg.textContent = "⏳ Provera koda…"; msg.style.color="#e8e8e8"; }

async function verify(){
  const v = (input.value||"").trim();
  if (!v) { showErr("Unesite kod."); dl.style.display="none"; return; }
  btn.disabled = true; showWait();
  try{
    const res = await fetch(WEB_APP_URL + "?kod=" + encodeURIComponent(v), {mode:"cors"});
    const html = await res.text();
    showHtml(html);               // Apps Script vraća HTML s linkom za download
    dl.style.display = "block";   // prikaži download boks
  }catch(e){
    showErr("Greška u povezivanju. Pokušajte ponovo.");
    dl.style.display = "none";
  }finally{
    btn.disabled = false;
  }
}

btn.addEventListener('click', verify);
input.addEventListener('keydown', e => { if(e.key==='Enter') verify(); });
</script>


</html>
